title: Read the local master key from a file
ref: read-local-master-key-from-file
level: 4
content: |
  First, read the file containing the local master key, generated in the
  :ref:`Create a Master Key <fle-create-a-master-key>` section:

  .. tabs::

     tabs:

       - id: use-cases-fle-guide-java
         name: "Java"
         content: |

           .. code-block:: java
              :emphasize-lines: 11

              String path = "master-key.txt";

              byte[] fileBytes = new byte[96];

              try (FileInputStream fis = new FileInputStream(path)) {
                fileBytes = fis.readAllBytes();
              } catch (IOException e) {
                e.printStackTrace();
              }

              final byte[] localMasterKey = Arrays.copyOf(fileBytes, 96);


---
title: Specify KMS provider settings
ref: specify-kms-provider-settings
level: 4
content: |
  Next, specify the KMS provider settings. Set the provider name to ``local``
  when using a local master key:

  .. tabs::

     tabs:

       - id: use-cases-fle-guide-java
         name: "Java"
         content: |

           .. code-block:: java
              :emphasize-lines: 4,5

              String kmsProvider = "local";

              Map<String, Map<String, Object>> kmsProviders = new HashMap<String, Map<String, Object>>() {{
                put(kmsProvider, new HashMap<String, Object>() {{
                  put("key", localMasterKey);
                }});
              }};


---
title: Construct the client
ref: construct-the-client
level: 4
content: |
  Create the client using the MongoDB connection string and key vault 
  namespace. In this example, we specify the ``encryption`` database and the 
  ``__keyVault`` collection:

  .. tabs::

     tabs:

       - id: use-cases-fle-guide-java
         name: "Java"
         content: |

           .. code-block:: java
              :emphasize-lines: 8,9,12

              String connectionString = "mongodb://localhost:27017";
              String keyVaultNamespace = "encryption.__keyVault";

              ClientEncryptionSettings clientEncryptionSettings = ClientEncryptionSettings.builder()
                .keyVaultMongoClientSettings(MongoClientSettings.builder()
                  .applyConnectionString(new ConnectionString(connectionString))
                  .build())
                .keyVaultNamespace(keyVaultNamespace)
                .kmsProviders(kmsProviders)
                .build();

              ClientEncryption clientEncryption = ClientEncryptions.create(clientEncryptionSettings);


  .. note::

     Ensure that the client has `ReadWrite
     <https://docs.mongodb.com/manual/reference/built-in-roles/#readWrite>`_
     permissions on the specified key vault namespace.


---
title: Verify the data encryption key was created
ref: verify-data-key-created
level: 4
content: |
  Verify that the key was created in your MongoDB replica set in the specified
  key vault namespace. The document should resemble the following:

  .. code-block:: none
  
     {
       "_id" : UUID("..."),
       "keyMaterial" : BinData(0,"..."),
       "creationDate" : ISODate("..."),
       "updateDate" : ISODate("..."),
       "status" : 0,
       "masterKey" : {
         "provider" : "local"
       }
     }
